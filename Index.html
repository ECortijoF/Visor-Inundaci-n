<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- Conectamos con la SDK de ArcGIS -->

    <link rel="stylesheet" href="https://js.arcgis.com/4.31/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.31/"></script>

    <style>

        body {
            height: 100vh;
            width: 100vw;
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #e6f5fc;
        }

        /* Contenedor del mapa */
        #viewDiv {
            height: 100%;
            width: 100%;
            position: relative;
        }

        /* Encabezado superior */
        #tituloVisor {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #0c5b9c;
            color: white;
            font-size: 20px;
            font-weight: bold;
            padding: 10px 25px;
            border-radius: 8px;
            z-index: 100;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        /* Botones de capas y leyenda */
        #toggleLayerList, #toggleLegend {
            position: absolute;
            top: 60px;
            right: 10px;
            z-index: 99;
            padding: 8px 12px;
            border: none;
            background-color: #54b2ff;
            color: white;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: bold;
            transition: 0.2s;
        }
        #toggleLegend {
            top: 105px;
        }

        /* Paneles de capa y leyenda */
        #layerListContainer, #legendContainer {
            position: absolute;
            top: 150px;
            right: 10px;
            width: 260px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 99;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0px 0px 8px rgba(0,0,0,0.1);
        }

        /* Contenedor de marcadores */
        #contenedorMarcadores {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 99;
            background: rgba(255, 255, 255, 0.5);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(84, 178, 255, 0.3);
            text-align: center;
            max-width: 95%;
            overflow-x: auto;
            white-space: nowrap;
        }

        /* Título del contenedor de marcadores */
        #contenedorMarcadores::before {
            content: "Ir a zonas más vulnerables de la isla";
            display: block;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #0077b6;
        }

        /* Botones de marcadores */
        .boton-marcador {
            background-color: #54b2ff;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 0 6px;
            display: inline-block;
            white-space: nowrap;
            transition: all 0.2s ease-in-out;
        }
        .boton-marcador:hover {
            background-color: #3ca3ef;
            transform: scale(1.05);
        }

        /* Panel informativo */
        #panelResultados {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 99;
            max-width: 320px;
            box-shadow: 0 0 10px rgba(0,0,0,0.15);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Ocultar */
        .hidden {
            display: none;
        }

    </style>

    <script defer>

        //Require, importar las cosas de la SDK
        require([
        "esri/Basemap",
        "esri/layers/VectorTileLayer",
        "esri/Map",
        "esri/views/SceneView",
        "esri/layers/FeatureLayer",
        "esri/renderers/SimpleRenderer",
        "esri/symbols/PolygonSymbol3D",
        "esri/symbols/WaterSymbol3DLayer",
        "esri/layers/SceneLayer",
        "esri/layers/GraphicsLayer",
        "esri/Graphic",
        "esri/widgets/ScaleBar",
        "esri/widgets/Compass",
        "esri/widgets/Home",
        "esri/widgets/Sketch",
        "esri/widgets/Sketch/SketchViewModel",
        "esri/widgets/LayerList",
        "esri/widgets/Legend",
        "esri/widgets/DirectLineMeasurement3D",
        "esri/widgets/CoordinateConversion",
        "esri/rest/support/Query",
        "esri/geometry/geometryEngine",
        "esri/symbols/SimpleFillSymbol"
        ], 
        (
        Basemap,
        VectorTileLayer,
        Map,
        SceneView,
        FeatureLayer,
        SimpleRenderer,
        PolygonSymbol3D,
        WaterSymbol3DLayer,
        SceneLayer,
        GraphicsLayer,
        Graphic,
        ScaleBar,
        Compass,
        Home,
        Sketch,
        SketchViewModel,
        LayerList,
        Legend,
        DirectLineMeasurement3D,
        CoordinateConversion,
        Query,
        geometryEngine,
        SimpleFillSymbol
        ) => {
            //Configuramos nuestro mapa base con una vector tile que hemos modificado anteriormente:
            const vectorTileBase = new VectorTileLayer({
                portalItem: {
                    id: "11988c2293a54b23962bcf7ef6a7e718"
                }
            })

            const mapaBase = new Basemap({
                baseLayers: [vectorTileBase],
                referenceLayers: [vectorTileBase]
            })
        
            //Configuramos nuestro mapa y la vista del mapa:
            const mapa = new Map({
                basemap: mapaBase,
                ground: "world-elevation",
                title: 'Agua',
                listMode: 'hide'
            })

            const vistaMapa3D = new SceneView({
                container: 'viewDiv',
                map: mapa,
                center: [-16.6425,28.2724],
                zoom: 11,
            })

            const escalaMinima = 450000; // más alejado (número mayor)
            const escalaMaxima = 1000;   // más cerca (número menor)

            vistaMapa3D.watch("scale", (nuevaEscala) => {
            if (nuevaEscala > escalaMinima) {
                vistaMapa3D.goTo({ scale: escalaMinima }, { animate: true });
            } else if (nuevaEscala < escalaMaxima) {
                vistaMapa3D.goTo({ scale: escalaMaxima }, { animate: true });
            }
            })

            //Importarmos y configuramos nuestras capas:

            //Primero el mar y rios de tenerife

                //Renderizado tipo agua
            const aguaRenderer = new SimpleRenderer({
                symbol: new PolygonSymbol3D({
                    symbolLayers: [
                        new WaterSymbol3DLayer({
                        waveDirection: 260,
                        color: '#a3f1ff',
                        waveStrength: 'moderate',
                        waterbodySize: 'large'
                    })]
                })
            })

                //Introducimos nuestra capa de mar
            const marTenerife = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Mapa_Mar_Islas_Canarias/FeatureServer',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title:'Agua',
                listMode: 'hide'
            })
            mapa.add(marTenerife)

                //Introducimos nuestra capa de rios
                const caucesTenerife = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/cauces_Buffer_intentodesesperado/FeatureServer',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                listMode: 'hide',
                legendEnabled: false
            })
            mapa.add(caucesTenerife)

            //Segundo los edificios

                //Renderizado de edificios según descripcion del uso
                const usoRenderer3D = {
                    type: "unique-value",
                    field: "USO_DESC",
                    defaultSymbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                        type: "fill",
                        material: { color: "gray" }
                        }]
                    },
                    defaultLabel: "Otros",
                    uniqueValueInfos: [
                        {
                        value: "Uso residencial",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#a4c7a1" } }] //Verde oliva suave
                        }
                        },
                        {
                        value: "Comercio mayorista y minorista, reparación de vehículos y de efectos personales y enseres domésticos",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#e4c97a" } }] //Amarillo dorado apagado
                        }
                        },
                        {
                        value: "Servicios sanitarios y sociales",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#e8a0a0" } }] //Rosa palo
                        }
                        },
                        {
                        value: "Servicios de educación",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#acc6e2" } }] //Azul claro
                        }
                        },
                        {
                        value: "Servicios culturales",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#c7b2db" } }] //Lila pastel
                        }
                        },
                        {
                        value: "Ocio",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#a4d5de" } }] //Azul cielo suave
                        }
                        },
                        {
                        value: "Restauración",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#d89a76" } }] //Marrón claro
                        }
                        },
                        {
                        value: "Alojamiento",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#c9b29b" } }] //Beige arena
                        }
                        },
                        {
                        value: "Servicios de administración pública, de defensa y de seguridad social",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#8c9cb5" } }] //Azul grisáceo
                        }
                        },
                        {
                        value: "Servicios logísticos y de almacenamiento",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#a5b793" } }] //Verde seco
                        }
                        },
                        {
                        value: "Otros servicios financieros, profesionales y de información",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#e9e5a2" } }] //	Amarillo pastel
                        }
                        },
                        {
                        value: "Servicios profesionales, técnicos y científicos",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#9baad3" } }] //Azul lavanda
                        }
                        },
                        {
                        value: "Producción secundaria",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#a6a6a6" } }] //Gris acero
                        }
                        },
                        {
                        value: "Producción agrícola comercial",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#cce1a3" } }] //Verde lima suave
                        }
                        },
                        {
                        value: "Producción de energía",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "##cf7754" } }] //Terracota
                        }
                        },
                        {
                        value: "Servicios de distribución de energía eléctrica, gas y energía térmica",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "	#4b7c8a" } }] //Azul petróleo
                        }
                        },
                        {
                        value: "Estaciones y áreas de servicio e infraestructuras",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#a59787" } }] //Gris marrón
                        }
                        },
                        {
                        value: "Áreas de estacionamiento",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#dcdcdc" } }] //	Gris cemento
                        }
                        },
                        {
                        value: "Vías",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#bcbcbc" } }] //Gris claro
                        }
                        },
                        {
                        value: "Parque urbano",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#b2ddb0" } }] //Verde menta
                        }
                        },
                        {
                        value: "Parque recreativo",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#c7e7c2" } }] //Verde claro
                        }
                        },
                        {
                        value: "Áreas naturales terrestres",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#aacfa2" } }] //Verde bosque claro
                        }
                        },
                        {
                        value: "Áreas transitorias",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#d1d1d1" } }] //Gris pálido
                        }
                        },
                        {
                        value: "Transporte marítimo por vías navegables interiores",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#7fb8c5" } }] //Azul verdoso
                        }
                        },
                        {
                        value: "Instalaciones deportivas",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#e6b089" } }] //	Naranja suave
                        }
                        },
                        {
                        value: "Otras actividades recreativas",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#e8b9d2" } }] //Rosa suave
                        }
                        },
                        {
                        value: "Uso desconocido",
                        symbol: {
                            type: "mesh-3d",
                            symbolLayers: [{ type: "fill", material: { color: "#8e8e8e" } }] //Gris neutro
                        }
                        }
                    ]
                    }

                //Introducimos nuestras capas de edificios y configuramos popups
            const edificios = new SceneLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Catastro_Total_Zonas_WSL1/SceneServer',
                elevationInfo: {
                    mode: "on-the-ground"
                },
                renderer: usoRenderer3D,
                title: 'Edificios',
                listMode: 'hide',
                popupTemplate:{
                    title: 'Edificio según referencia catastral: {Referencia_Catastral_14}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "USO_DESC",
                        label: "Tipo de uso",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Personas_Vivienda",
                        label: "Nº de personas potenciales de ser afectadas",
                        format: {
                        digitSeparator: true,
                        places: 0}},
                        {
                        fieldName: "Riesgo",
                        label: "Riesgo de ser afectado por inundación costera",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: 'SUPERF_M2',
                        label: 'Área (m2)',
                        format: {
                        digitSeparator: true}}
                ]
            }]}
            })
            mapa.add(edificios)

            //Introducimos nuestra capa de vegetación
            const vegetacion = new SceneLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Vegetaci%C3%B3n_Tenerife_WSL1/SceneServer',
                elevationInfo: {
                    mode: "on-the-ground"
                },
                legendEnabled: false,
                listMode: 'hide'
            })

            mapa.add(vegetacion)

            //Introducimos nuestras capas de inundación y configuramos popups
            const inun_100cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/13',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 100cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_125cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/12',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 125cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_150cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/11',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 150cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_175cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/10',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 175cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_200cm = new FeatureLayer ({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/9',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 200cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_225cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/8',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 225cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_250cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/7',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 250cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_275cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/6',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 275cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_300cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/5',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 300cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_325cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/4',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 325cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_350cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/3',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 350cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_375cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/2',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 375cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_400cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/1',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 400cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            const inun_425cm = new FeatureLayer({
                url: 'https://services8.arcgis.com/BtkRLT3YBKaVGV3g/arcgis/rest/services/Inundacion_Costera_Tenerife/FeatureServer/0',
                renderer: aguaRenderer,
                elevationInfo: {
                    mode: "on-the-ground"
                },
                title: 'Subida del nivel del mar 425cm',
                legendEnabled: false,
                visible: false,
                popupTemplate:{
                    title: 'Subida del nivel del mar (cm): {Subida_Nivel_Mar_cm}',
                    content: [{type: 'fields',
                    fieldInfos: [{
                        fieldName: "Edificios_Afectados",
                        label: "Nº de edificios Afectados",
                        format: {
                        digitSeparator: true}},
                        {
                        fieldName: "Shape__Area",
                        label: "Área inundada (m2)",
                        format: {
                        digitSeparator: true,}}
                ]
            }]}
            })

            mapa.addMany([inun_425cm, inun_400cm, inun_375cm, inun_350cm, inun_325cm, inun_300cm, inun_275cm, inun_250cm, inun_225cm, inun_200cm, inun_175cm, inun_150cm, inun_125cm, inun_100cm])

            // Añadimos y configuramos nuestros widgets:
            const widgetEscala = new ScaleBar({
                view: vistaMapa3D,
            })

            const widgetCasa = new Home({
                view: vistaMapa3D,
            })

            const widgetListaCapas = new LayerList({
                view: vistaMapa3D,
                container: 'layerListContainer'
            })

            const widgetLeyenda = new Legend({
                view: vistaMapa3D,
                container: 'legendContainer'
            })

            const widgetCoordenadas = new CoordinateConversion({
                view: vistaMapa3D
            })

            //configuramos camaras para hacer marcadores y luego la acción goTo para ir al punto a través de un boton
            const marcadorCandelaria = {
                position: {
                                    longitude: -16.271005,
                                    latitude: 28.321619,
                                    z: 2000
                                },
                                tilt: 70,
                                heading: 300
            }
            document.getElementById('botonCandelaria').addEventListener("click", () =>{
                vistaMapa3D.goTo({
                    position: marcadorCandelaria.position,
                    tilt: marcadorCandelaria.tilt,
                    heading: marcadorCandelaria.heading
                },{
                    duration: 2000
                })
            })

            const marcadorCostaSilencio = {
                position: {
                                    longitude: -16.655841,
                                    latitude: 27.970865,
                                    z: 2000
                                },
                                tilt: 70,
                                heading: 0

            }
            document.getElementById('botonCostaSilencio').addEventListener("click", () =>{
                vistaMapa3D.goTo({
                    position: marcadorCostaSilencio.position,
                    tilt: marcadorCostaSilencio.tilt,
                    heading: marcadorCostaSilencio.heading
                },{
                    duration: 2000
                })
            })

            const marcadorGranadillaAbona = {
                position: {
                                    longitude: -16.498674,
                                    latitude: 28.016026,
                                    z: 2000
                                },
                                tilt: 70,
                                heading: 325
            }
            document.getElementById('botonGranadillaAbona').addEventListener("click", () =>{
                vistaMapa3D.goTo({
                    position: marcadorGranadillaAbona.position,
                    tilt: marcadorGranadillaAbona.tilt,
                    heading: marcadorGranadillaAbona.heading
                },{
                    duration: 2000
                })
            })

            const marcadorCristianos = {
                position: {
                                    longitude: -16.790571,
                                    latitude: 28.039283,
                                    z: 2000
                                },
                                tilt: 70,
                                heading: 45
            }
            document.getElementById('botonCristianos').addEventListener("click", () =>{
                vistaMapa3D.goTo({
                    position: marcadorCristianos.position,
                    tilt: marcadorCristianos.tilt,
                    heading: marcadorCristianos.heading
                },{
                    duration: 2000
                })
            })

            const marcadorPuertoCruz = {
                position: {
                                    longitude: -16.561464,
                                    latitude: 28.481794,
                                    z: 2000
                                },
                                tilt: 70,
                                heading: 180
            }
            document.getElementById('botonPuertoCruz').addEventListener("click", () =>{
                vistaMapa3D.goTo({
                    position: marcadorPuertoCruz.position,
                    tilt: marcadorPuertoCruz.tilt,
                    heading: marcadorPuertoCruz.heading
                },{
                    duration: 2000
                })
            })

            const marcadorSantaCruzTenerife = {
                position: {
                                    longitude: -16.209781,
                                    latitude: 28.405988,
                                    z: 2000
                                },
                                tilt: 70,
                                heading: 305
            }
            document.getElementById('botonSantaCruzTenerife').addEventListener("click", () =>{
                vistaMapa3D.goTo({
                    position: marcadorSantaCruzTenerife.position,
                    tilt: marcadorSantaCruzTenerife.tilt,
                    heading: marcadorSantaCruzTenerife.heading
                },{
                    duration: 2000
                })
            })

            //Anadimos el widget al mapa
            vistaMapa3D.ui.add(widgetEscala, {position: 'bottom-left'})
            vistaMapa3D.ui.add(widgetCasa, {position: 'top-left'})

            //Configurción del boton para el desplegable de las capas
            const toggleButtonList = document.getElementById("toggleLayerList")
            const layerListDiv = document.getElementById("layerListContainer")

            toggleButtonList.addEventListener("click", () => {
                layerListDiv.classList.toggle("hidden")
            })

            //Configurción del boton para el desplegable de las capas
            const toggleButtonLegend = document.getElementById("toggleLegend")
            const legendDiv = document.getElementById("legendContainer")

            toggleButtonLegend.addEventListener("click", () => {
                legendDiv.classList.toggle("hidden")
            })

        })
        
    </script>

</head>
<body>

    <div id="tituloVisor">Inundaciones Costeras en Tenerife: Diagnóstico de áreas vulnerables</div>

    <!-- Contenedor que tiene la vista de mi mapa -->
    <div id = 'viewDiv'></div>

    <!-- boton para el desplegable de las capas -->
    <button id="toggleLayerList">Capas de inundación</button>

    <!-- Contenedor para el widget LayerList -->
    <div id="layerListContainer" class="hidden"></div>

    <!-- boton para el desplegable de la leyenda -->
    <button id="toggleLegend">Leyenda</button>

    <!-- Contenedor para el widget Legend -->
    <div id="legendContainer" class="hidden"></div>

    <!-- conetenedor y botones de los marcadores -->
    <div id ="contenedorMarcadores">
        <button class="boton-marcador" id="botonCandelaria">Candelaria</button>
        <button class="boton-marcador" id="botonCostaSilencio">Costa del Silencio</button>
        <button class="boton-marcador" id="botonGranadillaAbona">Granadilla de Abona</button>
        <button class="boton-marcador" id="botonCristianos">Los Cristianos</button>
        <button class="boton-marcador" id="botonPuertoCruz">Puerto de la Cruz</button>
        <button class="boton-marcador" id="botonSantaCruzTenerife">SantaCruz de Tenerife</button>
    </div>

</body>
</html>